generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id             String             @id
  roleId         String
  role           Role               @relation(fields: [roleId], references: [id])
  assignedShifts ShiftAssignment[]
  availability   Availability[]
  initiatedSwaps ShiftSwapRequest[]
  createdShifts  Shift[]
}

model Role {
  id    String @id @default(uuid())
  name  String @unique
  users User[]
}

model ShiftAssignment {
  userId String
  user   User   @relation(fields: [userId], references: [id])

  shiftId String
  shift   Shift  @relation(fields: [shiftId], references: [id])

  createdAt DateTime @default(now())

  // TODO: better names?
  swapRequestCurrents ShiftSwapRequest[] @relation("CurrentAssignment")
  swapRequestWanteds  ShiftSwapRequest[] @relation("WantedAssignment")

  @@id(name: "id", [userId, shiftId])
}

model Shift {
  id String @id @default(uuid())

  start DateTime
  end   DateTime

  assignedTo ShiftAssignment[]

  createdById String
  createdBy   User   @relation(fields: [createdById], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Availability {
  id String @id @default(uuid())

  userId String
  user   User   @relation(fields: [userId], references: [id])

  start DateTime
  end   DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ShiftSwapRequest {
  id String @id @default(uuid())

  createdById String
  createdBy   User   @relation(fields: [createdById], references: [id])

  currentShiftId    String
  currentUserId     String
  currentAssignment ShiftAssignment @relation("CurrentAssignment", fields: [currentShiftId, currentUserId], references: [shiftId, userId])

  wantedShiftId    String
  wantedUserId     String
  wantedAssignment ShiftAssignment @relation("WantedAssignment", fields: [wantedShiftId, wantedUserId], references: [shiftId, userId])

  status String @default("pending")

  createdAt DateTime @default(now())
}
